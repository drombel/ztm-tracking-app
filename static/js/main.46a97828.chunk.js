(this["webpackJsonpztm-tracker"]=this["webpackJsonpztm-tracker"]||[]).push([[0],{38:function(e,t,n){e.exports=n.p+"static/media/bus-logo.8ff7795b.png"},41:function(e,t,n){e.exports=n(75)},46:function(e,t,n){},68:function(e,t,n){},71:function(e,t,n){},72:function(e,t,n){},74:function(e,t,n){},75:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(6),o=n.n(c),l=(n(46),n(16)),i=n(3),u=n(11),s=n(7),m=n.n(s),d=n(12),p=n(19),f=n.n(p),v=f.a.create({baseURL:"https://ckan2.multimediagdansk.pl"}),b=function(){var e=Object(d.a)(m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.get("/gpsPositions").then((function(e){return e.data.Vehicles.filter((function(e){return e.GPSQuality>=2}))})).catch((function(e){return console.error(e),[]})).then((function(e){return e}));case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),h=function(){var e=Object(d.a)(m.a.mark((function e(){var t,n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(new Date).toISOString().split("T")[0],e.next=3,f.a.get("https://ckan.multimediagdansk.pl/dataset/c24aa637-3619-4dc2-a171-a23eec8f2172/resource/b15bb11c-7e06-4685-964e-3db7775f912f/download/trips.json").then((function(e){return e.data[t].trips})).catch((function(e){return console.error(e),[]})).then((function(e){return e}));case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),E=n(40),g=n(35),k=n(39);n(68);var N=function(e){var t,n=Object(a.useState)({id:0,hidden:!1}),c=Object(u.a)(n,2),o=c[0],l=c[1],i=Object(a.useState)([]),s=Object(u.a)(i,2),p=s[0],f=s[1],v=e.idField,b=Object(a.useRef)(null),h=e.mapMarker,N=null===e||void 0===e?void 0:e.mapSidebarItem,w=null!==(t=null===e||void 0===e?void 0:e.autoUpdate)&&void 0!==t&&t,y=Object(a.useState)(!1),x=Object(u.a)(y,2),O=x[0],j=x[1],S=Object(a.useRef)(),C=Object(a.useState)(null),I=Object(u.a)(C,2),M=I[0],T=I[1],L=Object(a.useState)(10),F=Object(u.a)(L,2),R=F[0],U=F[1],_=function(){var t=Object(d.a)(m.a.mark((function t(){var n,a;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,null===e||void 0===e?void 0:e.refreshFunc();case 2:if(t.t1=n=t.sent,t.t0=null!==t.t1,!t.t0){t.next=6;break}t.t0=void 0!==n;case 6:if(!t.t0){t.next=10;break}t.t2=n,t.next=11;break;case 10:t.t2=[];case 11:if(0!==(a=t.t2).length){t.next=15;break}return console.error("Fetched data from Tristar API is empty"),t.abrupt("return");case 15:f(a);case 16:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();Object(a.useEffect)((function(){return _(),w&&(b.current=setInterval((function(){return _()}),w)),function(){return clearTimeout(b.current)}}),[]);var D=function(e){var t=e.item,n=e.MapMarker,a=o.id===t[v]&&!o.hidden;t.current=a;return t.closeFunction=function(){return l({id:0,hidden:!0})},r.a.createElement(n,{item:t})},Z=function(e){var t=e.lat,n=e.lng,a=e.supercluster,c=e.cluster,o=e.pointCount;return r.a.createElement("div",{className:"marker",onClick:function(){var e=Math.min(a.getClusterExpansionZoom(c.id),20);S.current.setZoom(e),S.current.panTo({lat:t,lng:n})}},r.a.createElement("div",{className:"cluster"},o))};return r.a.createElement("div",{className:"map"},N&&r.a.createElement("div",{className:"map__sidebar".concat(O?" active":"")},r.a.createElement("div",{className:"map__sidebar-container"},p.map((function(e,t){var n=e[v]===o.id;return r.a.createElement("div",{className:"map__sidebar-item".concat(n?" active":""),key:t,onClick:function(){l({id:e[v],hidden:!1}),S.current.setZoom(16),S.current.panTo({lat:e.Lat,lng:e.Lon})}},r.a.createElement(N,{item:e}))})),r.a.createElement("div",{className:"menu-button",onClick:function(){return j((function(e){return!e}))}},r.a.createElement("span",null)))),r.a.createElement(g.a,{bootstrapURLKeys:{key:"AIzaSyBtEh6FMFwJA-0X7NNb8yDlQ1M7x-PJ8iU"},defaultCenter:e.center,defaultZoom:e.zoom,onChildClick:function(e,t){var n,a;null!==(n=null===(a=t.item)||void 0===a?void 0:a[v])&&void 0!==n&&n&&l((function(e){var n=e.id,a=e.hidden;return{id:n===t.item[v]?0:t.item[v],hidden:a}})),o.hidden&&l({id:0,hidden:!1})},onClick:function(e){return l({id:0,hidden:!1})},yesIWantToUseGoogleMapApiInternals:!0,shouldUnregisterMapOnUnmount:!0,onGoogleApiLoaded:function(e){var t=e.map;t.setClickableIcons(!1),S.current=t},onChange:function(e){var t=e.zoom,n=e.bounds;U(t),T([n.nw.lng,n.se.lat,n.se.lng,n.nw.lat])}},function(){var e=p.map((function(e){return{type:"Cluster",properties:{item:Object(E.a)({},e),cluster:!1},geometry:{type:"Point",coordinates:[parseFloat(e.Lon),parseFloat(e.Lat)]}}})),t=Object(k.a)({points:e,bounds:M,zoom:R,options:{radius:75,maxZoom:20}}),n=t.clusters,a=t.supercluster;return n.map((function(e,t){var n=Object(u.a)(e.geometry.coordinates,2),c=n[0],o=n[1],l=e.properties,i=l.cluster,s=l.point_count;return i?r.a.createElement(Z,{key:t,lat:o,lng:c,supercluster:a,cluster:e,pointCount:s}):r.a.createElement(D,{key:t,lat:o,lng:c,item:e.properties.item,MapMarker:h})}))}().map((function(e){return e}))))},w=n(17),y=function(e){var t=e.routes;return{type:"ROUTES_SET",payload:{routes:void 0===t?[]:t}}};var x=function(e){var t=Object(w.c)((function(e){return e.routes})),n=Object(w.b)(),c=function(){var e=Object(d.a)(m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=n,e.t1=y,e.next=4,h();case 4:return e.t2=e.sent,e.t3={routes:e.t2},e.t4=(0,e.t1)(e.t3),e.abrupt("return",(0,e.t0)(e.t4));case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(a.useEffect)((function(){0===t.length&&c()}),[]);var o=Object(a.useCallback)(Object(d.a)(m.a.mark((function e(){var n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b();case 2:return(n=(n=e.sent).map((function(e){return e.RouteStop=t.find((function(t){return t.tripId===parseInt(e.Route)&&t.routeId===parseInt(e.Line)})),e.DelayTime=new Date(1e3*Math.abs(e.Delay)).toISOString().substr(11,8).replace(/00:/,""),e}))).sort((function(e,t){return e.Line.localeCompare(t.Line)})),e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)}))),[t]);return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"vh-100"},t.length>0&&r.a.createElement(N,{center:{lat:54.385561,lng:18.600739},zoom:12,refreshFunc:o,idField:"VehicleId",autoUpdate:5e3,mapMarker:function(e){var t=e.item;return r.a.createElement("div",{className:"marker"},r.a.createElement("div",{className:"dot"},t.Line),t.current&&r.a.createElement("div",{className:"info"},r.a.createElement("table",{className:"table-responsive table-striped table-hover"},r.a.createElement("thead",{className:"w-100 d-table"},r.a.createElement("tr",null,r.a.createElement("td",{colSpan:2,onClick:t.closeFunction},"Hide"))),r.a.createElement("tbody",{className:"w-100 d-table"},t.Line&&r.a.createElement("tr",null,r.a.createElement("td",{className:"p-1"},"Line"),r.a.createElement("td",{className:"border-left p-1 font-weight-bold"},t.Line)),0!==t.Delay&&r.a.createElement("tr",null,r.a.createElement("td",{className:"p-1"},t.Delay>0?"Delay":"Before time"),r.a.createElement("td",{className:"border-left p-1 font-weight-bold"},t.DelayTime)),t.RouteStop&&r.a.createElement("tr",null,r.a.createElement("td",{className:"p-1"},"Route"),r.a.createElement("td",{className:"border-left p-1 font-weight-bold"},t.RouteStop.title)),t.VehicleCode&&r.a.createElement("tr",null,r.a.createElement("td",{className:"p-1"},"Vehicle code"),r.a.createElement("td",{className:"border-left p-1 font-weight-bold"},t.VehicleCode)),t.Speed>0&&r.a.createElement("tr",null,r.a.createElement("td",{className:"p-1"},"Speed"),r.a.createElement("td",{className:"border-left p-1 font-weight-bold"},null===t||void 0===t?void 0:t.Speed," km/h"))))))},mapSidebarItem:function(e){var t=e.item;return r.a.createElement("div",{className:"row no-gutters"},r.a.createElement("div",{className:"col-2 col-sm-3 p-2 font-weight-bold d-flex align-items-center justify-content-center"},t.Line),r.a.createElement("div",{className:"col-10 col-sm-9 p-2 font-weight-bold border-left"},t.RouteStop&&t.RouteStop.title))}})))},O=(n(71),[{to:"/",exact:!0,component:function(){return r.a.createElement("div",{className:"p-4"},r.a.createElement("pre",{className:"text-wrap text-break"},r.a.createElement("h2",null,"ZTM Tracker"),r.a.createElement("p",null,"Application represents ZTM data based on their API which can be found ",r.a.createElement("a",{href:"https://ckan.multimediagdansk.pl/dataset/tristar",rel:"noopener noreferrer",target:"_blank",className:"font-weight-normal"},"here"),"."),r.a.createElement("p",null,"For this moment You can see current position of the vehicles like buses and trams around Gda\u0144sk area. Each vehicle shows delay and unique vehicle code.")))}},{to:"/buses",component:function(){return r.a.createElement("div",null,r.a.createElement(x,null))},title:"Buses"}]),j=n(38),S=n.n(j),C=(n(72),function(){var e=Object(a.useState)(!1),t=Object(u.a)(e,2),n=t[0],c=t[1],o=function(){return c(!0)};return r.a.createElement("header",{className:n?"active":""},r.a.createElement("nav",null,r.a.createElement("div",{className:"nav-brand p-3"},r.a.createElement(l.b,{to:"/",className:"text-decoration-none",onClick:o},r.a.createElement("img",{src:S.a,alt:"ZTM tracker",className:"img-fluid"}),r.a.createElement("div",{className:"h2 text-white text-center"},"ZTM tracker"))),r.a.createElement("ul",{className:"nav flex-column"},O.map((function(e,t){var n=e.to,a=e.title;e.exact;return a&&r.a.createElement(l.c,{to:n,exact:!0,key:t,className:"nav-item text-decoration-none py-2 px-3 font-weight-normal h5 m-0",activeClassName:"shadow active",onClick:o},a)})))),r.a.createElement("div",{className:"menu-button",onClick:function(){return c((function(e){return!e}))}},r.a.createElement("span",null)))}),I=function(){return r.a.createElement("div",{className:"p-4"},r.a.createElement("pre",{className:"text-wrap"},"Sorry, but we couldn't find what you have been looking for :("))};n(74);var M=function(){return r.a.createElement("div",{className:"App min-vh-100"},r.a.createElement(l.a,null,r.a.createElement("div",{className:"d-flex"},r.a.createElement(C,null),r.a.createElement("main",{className:"min-vh-100"},r.a.createElement(i.c,null,O.map((function(e,t){return r.a.createElement(i.a,{exact:e.exact,path:e.to,key:t,component:e.component})})),r.a.createElement(i.a,{component:I}))))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var T=n(14),L=[],F=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:L,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ROUTES_SET":var n=t.payload.routes.map((function(e){return e.title=e.tripHeadsign.replace(/\(\d+\)/g,""),e}));return n;default:return e}},R=Object(T.b)({routes:F}),U=Object(T.c)(R);o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(w.a,{store:U},r.a.createElement(M,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[41,1,2]]]);
//# sourceMappingURL=main.46a97828.chunk.js.map